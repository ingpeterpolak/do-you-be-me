<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <link href="assets/main.css" rel="stylesheet">
    <title>Do/You Be/Me</title>
</head>
<body>
    <div class="container">
        <div class="d-grid gap-3">
            <div class="p-2">
                <h1 class="mt-4">Do/You Be/Me</h1>
                {{.Message}}
            </div>
            <div class="p-2 lyrics-main">
                <textarea id="lyrics" class="form-control" placeholder="Put your lyrics here" style="height: 200pt"></textarea>
                <div id="results" style="display:none"></div>
            </div>
            <div class="p-2">
                <button id="pimpButton" type="button" class="btn btn-primary" onclick="javascript:pimp()">Pimp my song!</button>
                <button id="resetButton" style="display:none" type="button" class="btn btn-primary" onclick="javascript:reset()">Let's do one more!</button>
            </div>
        </div>
    </div>
</body>
<script type="text/javascript">
    var lyricsTextarea = document.getElementById("lyrics");
    var resultsDiv = document.getElementById("results");
    var pimpButton = document.getElementById("pimpButton");
    var resetButton = document.getElementById("resetButton");

    function pimp() {
        // var lyrics = lyricsTextarea.value.replaceAll("\n", "\\n").replaceAll("&", "&amp;");
        var lyrics = encodeURIComponent(lyricsTextarea.value);
        fetch("/pimp?lyrics=" + lyrics)
        .then(response => response.json())
        .then(data => {
            lyricsTextarea.style.display = "none";
            pimpButton.style.display = "none";

            resetButton.style.display = "block";
            resultsDiv.style.display = "block";

            resultsDiv.innerHTML = "";
            
            data.lines.forEach(line => {
                var paragraph = document.createElement("div");
                paragraph.innerHTML = "<div class=\"lyrics-line\"><div class=\"line-number\">" + line.number + "</div><div>" + line.line + "</div><div class=\"clearer\"></div></div>";
                resultsDiv.appendChild(paragraph);
            })
        })
    }

    function reset() {
        resetButton.style.display = "none";
        resultsDiv.style.display = "none";

        lyricsTextarea.style.display = "block";
        pimpButton.style.display = "block";
    }
</script>
</html>